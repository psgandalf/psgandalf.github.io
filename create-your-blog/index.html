<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Create Your Blog with SvelteKit</title><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/styles/github.min.css" data-svelte="svelte-dd1lau"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Overpass" data-svelte="svelte-dd1lau"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Mono" data-svelte="svelte-dd1lau">

		

		<link rel="modulepreload" href="/a/_app/start-5e88bb69.js">
		<link rel="modulepreload" href="/a/_app/chunks/vendor-1023b73e.js">
		<link rel="modulepreload" href="/a/_app/chunks/paths-45dac81d.js">
		<link rel="modulepreload" href="/a/_app/pages/__layout.svelte-053f6bb2.js">
		<link rel="modulepreload" href="/a/_app/pages/[slug].svelte-51976f72.js">
		<link rel="stylesheet" href="/a/_app/assets/start-0826e215.css">
		<link rel="stylesheet" href="/a/_app/assets/pages/__layout.svelte-9f42d68a.css">
		<link rel="stylesheet" href="/a/_app/assets/pages/[slug].svelte-7f9e302b.css">

		<script type="module">
			import { start } from "/a/_app/start-5e88bb69.js";
			start({
				target: document.querySelector("#svelte"),
				paths: {"base":"/a","assets":"/a"},
				session: {},
				host: location.host,
				route: true,
				spa: false,
				trailing_slash: "never",
				hydrate: {
					status: 200,
					error: null,
					nodes: [
						import("/a/_app/pages/__layout.svelte-053f6bb2.js"),
						import("/a/_app/pages/[slug].svelte-51976f72.js")
					],
					page: {
						host: location.host, // TODO this is redundant
						path: "/create-your-blog",
						query: new URLSearchParams(""),
						params: {"slug":"create-your-blog"}
					}
				}
			});
		</script>
	</head>
	<body>
		<div id="svelte">





<a href="https://github.com/svelteland/svelte-kit-blog-demo" class="github-corner svelte-1demiu8" aria-label="View source on GitHub"><svg width="60" height="60" viewBox="0 0 250 250" style="fill:#444; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm svelte-1demiu8"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg>
</a>

<div class="g-app-wrapper svelte-11xjeh8"><div><nav class="svelte-lorm98"><a href="/a/" class="svelte-lorm98"><h3 class="home svelte-lorm98">HOME</h3></a>
    <a href="/a/about" class="svelte-lorm98"><h3 class="about svelte-lorm98">about</h3></a></nav>
</div>
  

<h1 class="title svelte-3xaql2">Create Your Blog with SvelteKit</h1>
<p class="info"><a href="https://github.com/zhuzilin">zhuzilin</a> APR 3, 2021</p>
<p>Recently, SvelteKit is <a href="https://svelte.dev/blog/sveltekit-beta">released in public beta</a>. And we could finally see what Rich Harris called "<a href="https://www.youtube.com/watch?v=qSfdtmcZ4d0">Futuristic Web Development</a>" looks like. It's always better to learn with project, so I made a little blog (the one you are reading) with SvelteKit and deployed it on the Github Pages. And this series of posts are the things I learnt.</p>
<h2>Brief Intro of Svelte and SvelteKit</h2>
<p>For those who are not familiar with Svelte and SvelteKit:</p>
<p><a href="https://svelte.dev/">Svelte</a> is a reactive Web component framework. Unlike traditionaly counterparts like React and Vue, Svelte does not use virtual dom (vdom). Instead, Svelte compiles the app to vanilla js during building. This results in an extreme small bundle size and blazing fast speed, as the app no longer contains runtime code and has get rid of the overheads of vdom relevant computation. In addition, Svelte is designed to be very close to plain HTML and CSS, which makes the code clean and easy to read.</p>
<p><a href="https://kit.svelte.dev/">SvelteKit</a> is the framework for building Svelte based app. With the help of <a href="https://vitejs.dev/">Vite</a>, SvelteKit provides excellent developing experience.</p>
<h2>Minimal SvelteKit Tutorial</h2>
<p>I'm not going to introduce how to use Svelte in this series of posts, as the official doc has done a great job. As for SvelteKit, I will try to cover only the bits and bobs used for the blog app. Anyway, it's very recommended to go through the <a href="https://svelte.dev/tutorial/basics">Svelte tutorial</a> and the <a href="https://kit.svelte.dev/docs">SvelteKit doc</a>.</p>
<h3>Routing and Layout</h3>
<p>The blog site contains 3 types of pages:</p>
<ul>
<li>index page: show the list of post titles</li>
<li>post page: render markdown file into beautiful html</li>
<li>about page: show about information</li>
</ul>
<p>In SvelteKit, we have a so-called <em>a filesystem-based router</em>. The files in <code>src/route</code> will correspond to the actual webpage. In our case, the folder structure of <code>src/route</code> would be:</p>
<pre><code class="hljs language-stylus">route
├── <span class="hljs-variable">$layout</span><span class="hljs-selector-class">.svelte</span>
├── about<span class="hljs-selector-class">.svelte</span>
├── <span class="hljs-selector-attr">[slug]</span><span class="hljs-selector-class">.svelte</span>
└── index<span class="hljs-selector-class">.svelte</span>
</code></pre>
<p>where <code>about.svelte</code> will be <code>xxx.com/about</code>, <code>index.svelte</code> will be <code>xxx.com/</code>. As for the <code>[slug].svelte</code>, it is a dynamic route, whose dynamic parameter is the <code>slug</code> in the bracket. For example, we may have a generated <code>xxx.com/hello-world</code>, then SvelteKit will use <code>[slug].svelte</code> to generate this page and set <code>slug</code> to <code>hello-world</code>.</p>
<p>The remaining <code>$layout.svelte</code> file serves as the layout template, all other files will be rendered inside the <code>&#x3C;slot>&#x3C;/slot></code> of it.</p>
<h3>Import Components</h3>
<p>A typical use of the layout file is adding a navigation bar. In SvelteKit, we should put the extracted components in <code>src/lib</code> and use the <code>$lib/xxx</code> to import them. In our case, I added a <code>Nav.svelte</code> in <code>src/lib</code>:</p>
<pre><code class="hljs language-html"><span class="hljs-comment">&#x3C;!--lib/Nav.svelte--></span>
<span class="hljs-tag">&#x3C;<span class="hljs-name">div</span>></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">nav</span>></span>
    <span class="hljs-tag">&#x3C;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span>></span><span class="hljs-tag">&#x3C;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"home"</span>></span>HOME<span class="hljs-tag">&#x3C;/<span class="hljs-name">h3</span>></span><span class="hljs-tag">&#x3C;/<span class="hljs-name">a</span>></span>
    <span class="hljs-tag">&#x3C;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/about"</span>></span><span class="hljs-tag">&#x3C;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"about"</span>></span>about<span class="hljs-tag">&#x3C;/<span class="hljs-name">h3</span>></span><span class="hljs-tag">&#x3C;/<span class="hljs-name">a</span>></span>
  <span class="hljs-tag">&#x3C;/<span class="hljs-name">nav</span>></span>
<span class="hljs-tag">&#x3C;/<span class="hljs-name">div</span>></span>
</code></pre>
<p>And in <code>$layout.svelte</code>, I can import the <code>Nav</code> component in this way:</p>
<pre><code class="hljs language-html"><span class="hljs-tag">&#x3C;<span class="hljs-name">script</span>></span><span class="javascript">
  <span class="hljs-keyword">import</span> <span class="hljs-string">'../app.scss'</span>;
  <span class="hljs-keyword">import</span> Nav <span class="hljs-keyword">from</span> <span class="hljs-string">'$lib/Nav.svelte'</span>;
</span><span class="hljs-tag">&#x3C;/<span class="hljs-name">script</span>></span>

<span class="hljs-tag">&#x3C;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"g-app-wrapper"</span>></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">Nav</span>/></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">slot</span>></span><span class="hljs-tag">&#x3C;/<span class="hljs-name">slot</span>></span>
<span class="hljs-tag">&#x3C;/<span class="hljs-name">div</span>></span>
</code></pre>
<h3>EndPoints and Data Loading</h3>
<p>With routing, layout and components, we could build most of the blog.  But there is one important question: how should we get the markdown file and render it to beautiful html? I'll talk about the details about how to parse the markdown file with <code>remark</code> later. For now, let's take a step back: we need to understand how SvelteKit would load the data from server to browser.</p>
<p>In SvelteKit, data are transfered in JSON format. For each page component that requires data, we need to create a corresponding <code>.json.js</code> as the endpoints. <strong>Endpoints</strong> in SvelteKit are those <code>.js</code> (or <code>.ts</code> if you are using TypeScript) files that contains functions for HTTP methods. For example, in the index page, we need to get the list of post titles from the server (assume we are hosting the app with a server instead of generating static pages), therefore, we need to create a <code>index.json.js</code> file with a <code>get</code> function:</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// index.json.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-comment">// our markdown files lie in src/posts.</span>
  <span class="hljs-keyword">let</span> postTitles = fs.readdirSync(<span class="hljs-string">`src/posts`</span>)
      .map(<span class="hljs-function"><span class="hljs-params">fileName</span> =></span> getTitleFrom(fileName));
  <span class="hljs-keyword">let</span> body = <span class="hljs-built_in">JSON</span>.stringify(postTitles);

  <span class="hljs-keyword">return</span> { body }
}
</code></pre>
<p>Notive that because the endpoints will be run on the server, we can use libraries like <code>fs</code>.</p>
<p>And for the <code>[slug].svelte</code> page, we will also have a <code>[slug].json.js</code> to get the post html:</p>
<pre><code class="hljs language-js"><span class="hljs-comment">// [slug].json.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span>(<span class="hljs-params">{ params }</span>) </span>{
  <span class="hljs-comment">// we could get the dynamic slug from the parameter of get.</span>
  <span class="hljs-keyword">const</span> { slug } = params;

  <span class="hljs-keyword">const</span> { metadata, content } = process(<span class="hljs-string">`src/posts/<span class="hljs-subst">${slug}</span>.md`</span>);
  <span class="hljs-keyword">const</span> body = <span class="hljs-built_in">JSON</span>.stringify({ metadata, content });

  <span class="hljs-keyword">return</span> { body }
}
</code></pre>
<p>Now we have the function that supply the data, we can use the <code>load</code> function to load them. Take <code>[slug].svelte</code> as example, we will add</p>
<pre><code class="hljs language-html"><span class="hljs-tag">&#x3C;<span class="hljs-name">script</span> <span class="hljs-attr">context</span>=<span class="hljs-string">"module"</span>></span><span class="javascript">
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">load</span>(<span class="hljs-params">{ page, fetch }</span>) </span>{
    <span class="hljs-keyword">const</span> slug = page.params.slug;
    <span class="hljs-keyword">const</span> post = <span class="hljs-keyword">await</span> fetch(<span class="hljs-string">`<span class="hljs-subst">${slug}</span>.json`</span>)
        .then(<span class="hljs-function">(<span class="hljs-params">r</span>) =></span> r.json());
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">props</span>: { post }
    };
  }
</span><span class="hljs-tag">&#x3C;/<span class="hljs-name">script</span>></span>

<span class="hljs-tag">&#x3C;<span class="hljs-name">script</span>></span><span class="javascript">
  <span class="hljs-comment">// post will have metadata and content</span>
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">let</span> post;
</span><span class="hljs-tag">&#x3C;/<span class="hljs-name">script</span>></span>

<span class="hljs-comment">&#x3C;!--show the post html with @html--></span>
{@html post.content}
</code></pre>
<p>to the top of the <code>[slug].svelte</code>, so that the page could get data from <code>${slug}.json</code>. And remember to add <code>context="module"</code> to the script tag around <code>load</code>, as we need the data load before the component is rendered.</p>
<p>Similarly, we could add the <code>load</code> function to <code>index.svelte</code> and this is the basic data stream in SvelteKit.</p>
<h2>Parse and Render the markdown files</h2>
<p>For this blog, I chose <a href="https://github.com/remarkjs/remark">remark</a> as the markdown processor. It is one of the most popular markdown parser now and is the one that supports the great <a href="https://www.gatsbyjs.com/">Gatsby</a>.</p>
<p><a href="https://github.com/remarkjs/remark">remark</a> is actually a part of the <a href="https://unifiedjs.com/">unifiedjs</a> ecosystem, a bunch of tools to help extracting the syntax tree or converting between content formats like markdown or html. To convert a markdown file into html, we could simply:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> vfile <span class="hljs-keyword">from</span> <span class="hljs-string">'to-vfile'</span>;
<span class="hljs-keyword">import</span> unified <span class="hljs-keyword">from</span> <span class="hljs-string">'unified'</span>;
<span class="hljs-keyword">import</span> remarkParse <span class="hljs-keyword">from</span> <span class="hljs-string">'remark-parse'</span>
<span class="hljs-keyword">import</span> remark2rehype <span class="hljs-keyword">from</span> <span class="hljs-string">'remark-rehype'</span>
<span class="hljs-keyword">import</span> stringify <span class="hljs-keyword">from</span> <span class="hljs-string">'rehype-stringify'</span>

<span class="hljs-keyword">let</span> processor = unified()
    .use(remarkParse)    <span class="hljs-comment">// parse into markdown syntax tree</span>
    .use(remark2rehype)  <span class="hljs-comment">// convert to html syntax tree</span>
    .use(stringify)      <span class="hljs-comment">// turn html syntax tree to html</span>

<span class="hljs-comment">// process function will return the generated html string.</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">process</span>(<span class="hljs-params">filename</span>) </span>{
    <span class="hljs-comment">// use vfile to read the file, could use fs if you like.</span>
    <span class="hljs-keyword">return</span> processor.processSync(vfile.readSync(filename));
}
</code></pre>
<p>Notice that unifiedjs is organized with multi-repo pattern and all the packages imported in the above snippet are in separate repos.</p>
<p>To get the title of the markdown file for index page, I added a metadata section to the markdown file. I'm not sure if I did this in the correctly, so I'm not going to describe my solution. If you have interest in parsing the metadata of the markdown, please refer to the <a href="https://github.com/svelteland/svelte-kit-blog-demo/blob/main/src/lib/markdown.js"><code>markdown.js</code></a> file in the repo.</p>
<h2>Conclusion</h2>
<p>Hurray! We have built a blog app that runs locally. Next I will show you how to deploy the blog to Github Pages.</p>
<h2>Tips</h2>
<p>Some confusing errors could be solved by moving the dependencies to <code>devDependencies</code> due to some bugs of Vite.</p>
</div>



	<script type="svelte-data" url="/create-your-blog.json">{"status":200,"statusText":"","headers":{"content-type":"text/plain;charset=UTF-8"},"body":"{\"metadata\":{\"title\":\"Create Your Blog with SvelteKit\",\"date\":\"Apr 3, 2021\",\"excerpt\":\"It's time to rewrite your blog in SvelteKit!\"},\"content\":\"\u003Cp\u003ERecently, SvelteKit is \u003Ca href=\\\"https:\u002F\u002Fsvelte.dev\u002Fblog\u002Fsveltekit-beta\\\"\u003Ereleased in public beta\u003C\u002Fa\u003E. And we could finally see what Rich Harris called \\\"\u003Ca href=\\\"https:\u002F\u002Fwww.youtube.com\u002Fwatch?v=qSfdtmcZ4d0\\\"\u003EFuturistic Web Development\u003C\u002Fa\u003E\\\" looks like. It's always better to learn with project, so I made a little blog (the one you are reading) with SvelteKit and deployed it on the Github Pages. And this series of posts are the things I learnt.\u003C\u002Fp\u003E\\n\u003Ch2\u003EBrief Intro of Svelte and SvelteKit\u003C\u002Fh2\u003E\\n\u003Cp\u003EFor those who are not familiar with Svelte and SvelteKit:\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Ca href=\\\"https:\u002F\u002Fsvelte.dev\u002F\\\"\u003ESvelte\u003C\u002Fa\u003E is a reactive Web component framework. Unlike traditionaly counterparts like React and Vue, Svelte does not use virtual dom (vdom). Instead, Svelte compiles the app to vanilla js during building. This results in an extreme small bundle size and blazing fast speed, as the app no longer contains runtime code and has get rid of the overheads of vdom relevant computation. In addition, Svelte is designed to be very close to plain HTML and CSS, which makes the code clean and easy to read.\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Ca href=\\\"https:\u002F\u002Fkit.svelte.dev\u002F\\\"\u003ESvelteKit\u003C\u002Fa\u003E is the framework for building Svelte based app. With the help of \u003Ca href=\\\"https:\u002F\u002Fvitejs.dev\u002F\\\"\u003EVite\u003C\u002Fa\u003E, SvelteKit provides excellent developing experience.\u003C\u002Fp\u003E\\n\u003Ch2\u003EMinimal SvelteKit Tutorial\u003C\u002Fh2\u003E\\n\u003Cp\u003EI'm not going to introduce how to use Svelte in this series of posts, as the official doc has done a great job. As for SvelteKit, I will try to cover only the bits and bobs used for the blog app. Anyway, it's very recommended to go through the \u003Ca href=\\\"https:\u002F\u002Fsvelte.dev\u002Ftutorial\u002Fbasics\\\"\u003ESvelte tutorial\u003C\u002Fa\u003E and the \u003Ca href=\\\"https:\u002F\u002Fkit.svelte.dev\u002Fdocs\\\"\u003ESvelteKit doc\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\\n\u003Ch3\u003ERouting and Layout\u003C\u002Fh3\u003E\\n\u003Cp\u003EThe blog site contains 3 types of pages:\u003C\u002Fp\u003E\\n\u003Cul\u003E\\n\u003Cli\u003Eindex page: show the list of post titles\u003C\u002Fli\u003E\\n\u003Cli\u003Epost page: render markdown file into beautiful html\u003C\u002Fli\u003E\\n\u003Cli\u003Eabout page: show about information\u003C\u002Fli\u003E\\n\u003C\u002Ful\u003E\\n\u003Cp\u003EIn SvelteKit, we have a so-called \u003Cem\u003Ea filesystem-based router\u003C\u002Fem\u003E. The files in \u003Ccode\u003Esrc\u002Froute\u003C\u002Fcode\u003E will correspond to the actual webpage. In our case, the folder structure of \u003Ccode\u003Esrc\u002Froute\u003C\u002Fcode\u003E would be:\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"hljs language-stylus\\\"\u003Eroute\\n├── \u003Cspan class=\\\"hljs-variable\\\"\u003E$layout\u003C\u002Fspan\u003E\u003Cspan class=\\\"hljs-selector-class\\\"\u003E.svelte\u003C\u002Fspan\u003E\\n├── about\u003Cspan class=\\\"hljs-selector-class\\\"\u003E.svelte\u003C\u002Fspan\u003E\\n├── \u003Cspan class=\\\"hljs-selector-attr\\\"\u003E[slug]\u003C\u002Fspan\u003E\u003Cspan class=\\\"hljs-selector-class\\\"\u003E.svelte\u003C\u002Fspan\u003E\\n└── index\u003Cspan class=\\\"hljs-selector-class\\\"\u003E.svelte\u003C\u002Fspan\u003E\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003Ewhere \u003Ccode\u003Eabout.svelte\u003C\u002Fcode\u003E will be \u003Ccode\u003Exxx.com\u002Fabout\u003C\u002Fcode\u003E, \u003Ccode\u003Eindex.svelte\u003C\u002Fcode\u003E will be \u003Ccode\u003Exxx.com\u002F\u003C\u002Fcode\u003E. As for the \u003Ccode\u003E[slug].svelte\u003C\u002Fcode\u003E, it is a dynamic route, whose dynamic parameter is the \u003Ccode\u003Eslug\u003C\u002Fcode\u003E in the bracket. For example, we may have a generated \u003Ccode\u003Exxx.com\u002Fhello-world\u003C\u002Fcode\u003E, then SvelteKit will use \u003Ccode\u003E[slug].svelte\u003C\u002Fcode\u003E to generate this page and set \u003Ccode\u003Eslug\u003C\u002Fcode\u003E to \u003Ccode\u003Ehello-world\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\\n\u003Cp\u003EThe remaining \u003Ccode\u003E$layout.svelte\u003C\u002Fcode\u003E file serves as the layout template, all other files will be rendered inside the \u003Ccode\u003E&#x3C;slot\u003E&#x3C;\u002Fslot\u003E\u003C\u002Fcode\u003E of it.\u003C\u002Fp\u003E\\n\u003Ch3\u003EImport Components\u003C\u002Fh3\u003E\\n\u003Cp\u003EA typical use of the layout file is adding a navigation bar. In SvelteKit, we should put the extracted components in \u003Ccode\u003Esrc\u002Flib\u003C\u002Fcode\u003E and use the \u003Ccode\u003E$lib\u002Fxxx\u003C\u002Fcode\u003E to import them. In our case, I added a \u003Ccode\u003ENav.svelte\u003C\u002Fcode\u003E in \u003Ccode\u003Esrc\u002Flib\u003C\u002Fcode\u003E:\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"hljs language-html\\\"\u003E\u003Cspan class=\\\"hljs-comment\\\"\u003E&#x3C;!--lib\u002FNav.svelte--\u003E\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"hljs-tag\\\"\u003E&#x3C;\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"hljs-tag\\\"\u003E&#x3C;\u003Cspan class=\\\"hljs-name\\\"\u003Enav\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"hljs-tag\\\"\u003E&#x3C;\u003Cspan class=\\\"hljs-name\\\"\u003Ea\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003Ehref\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E\\\"\u002F\\\"\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&#x3C;\u003Cspan class=\\\"hljs-name\\\"\u003Eh3\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003Eclass\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E\\\"home\\\"\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003EHOME\u003Cspan class=\\\"hljs-tag\\\"\u003E&#x3C;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Eh3\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&#x3C;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Ea\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"hljs-tag\\\"\u003E&#x3C;\u003Cspan class=\\\"hljs-name\\\"\u003Ea\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003Ehref\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E\\\"\u002Fabout\\\"\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&#x3C;\u003Cspan class=\\\"hljs-name\\\"\u003Eh3\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003Eclass\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E\\\"about\\\"\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003Eabout\u003Cspan class=\\\"hljs-tag\\\"\u003E&#x3C;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Eh3\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&#x3C;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Ea\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"hljs-tag\\\"\u003E&#x3C;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Enav\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"hljs-tag\\\"\u003E&#x3C;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003EAnd in \u003Ccode\u003E$layout.svelte\u003C\u002Fcode\u003E, I can import the \u003Ccode\u003ENav\u003C\u002Fcode\u003E component in this way:\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"hljs language-html\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&#x3C;\u003Cspan class=\\\"hljs-name\\\"\u003Escript\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"javascript\\\"\u003E\\n  \u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E'..\u002Fapp.scss'\u003C\u002Fspan\u003E;\\n  \u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E Nav \u003Cspan class=\\\"hljs-keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E'$lib\u002FNav.svelte'\u003C\u002Fspan\u003E;\\n\u003C\u002Fspan\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&#x3C;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Escript\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"hljs-tag\\\"\u003E&#x3C;\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003Eclass\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E\\\"g-app-wrapper\\\"\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"hljs-tag\\\"\u003E&#x3C;\u003Cspan class=\\\"hljs-name\\\"\u003ENav\u003C\u002Fspan\u003E\u002F\u003E\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"hljs-tag\\\"\u003E&#x3C;\u003Cspan class=\\\"hljs-name\\\"\u003Eslot\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&#x3C;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Eslot\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"hljs-tag\\\"\u003E&#x3C;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Ediv\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Ch3\u003EEndPoints and Data Loading\u003C\u002Fh3\u003E\\n\u003Cp\u003EWith routing, layout and components, we could build most of the blog.  But there is one important question: how should we get the markdown file and render it to beautiful html? I'll talk about the details about how to parse the markdown file with \u003Ccode\u003Eremark\u003C\u002Fcode\u003E later. For now, let's take a step back: we need to understand how SvelteKit would load the data from server to browser.\u003C\u002Fp\u003E\\n\u003Cp\u003EIn SvelteKit, data are transfered in JSON format. For each page component that requires data, we need to create a corresponding \u003Ccode\u003E.json.js\u003C\u002Fcode\u003E as the endpoints. \u003Cstrong\u003EEndpoints\u003C\u002Fstrong\u003E in SvelteKit are those \u003Ccode\u003E.js\u003C\u002Fcode\u003E (or \u003Ccode\u003E.ts\u003C\u002Fcode\u003E if you are using TypeScript) files that contains functions for HTTP methods. For example, in the index page, we need to get the list of post titles from the server (assume we are hosting the app with a server instead of generating static pages), therefore, we need to create a \u003Ccode\u003Eindex.json.js\u003C\u002Fcode\u003E file with a \u003Ccode\u003Eget\u003C\u002Fcode\u003E function:\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"hljs language-js\\\"\u003E\u003Cspan class=\\\"hljs-comment\\\"\u003E\u002F\u002F index.json.js\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-function\\\"\u003E\u003Cspan class=\\\"hljs-keyword\\\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-title\\\"\u003Eget\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-params\\\"\u003E\u003C\u002Fspan\u003E) \u003C\u002Fspan\u003E{\\n  \u003Cspan class=\\\"hljs-comment\\\"\u003E\u002F\u002F our markdown files lie in src\u002Fposts.\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"hljs-keyword\\\"\u003Elet\u003C\u002Fspan\u003E postTitles = fs.readdirSync(\u003Cspan class=\\\"hljs-string\\\"\u003E`src\u002Fposts`\u003C\u002Fspan\u003E)\\n      .map(\u003Cspan class=\\\"hljs-function\\\"\u003E\u003Cspan class=\\\"hljs-params\\\"\u003EfileName\u003C\u002Fspan\u003E =\u003E\u003C\u002Fspan\u003E getTitleFrom(fileName));\\n  \u003Cspan class=\\\"hljs-keyword\\\"\u003Elet\u003C\u002Fspan\u003E body = \u003Cspan class=\\\"hljs-built_in\\\"\u003EJSON\u003C\u002Fspan\u003E.stringify(postTitles);\\n\\n  \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E { body }\\n}\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003ENotive that because the endpoints will be run on the server, we can use libraries like \u003Ccode\u003Efs\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\\n\u003Cp\u003EAnd for the \u003Ccode\u003E[slug].svelte\u003C\u002Fcode\u003E page, we will also have a \u003Ccode\u003E[slug].json.js\u003C\u002Fcode\u003E to get the post html:\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"hljs language-js\\\"\u003E\u003Cspan class=\\\"hljs-comment\\\"\u003E\u002F\u002F [slug].json.js\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-function\\\"\u003E\u003Cspan class=\\\"hljs-keyword\\\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-title\\\"\u003Eget\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-params\\\"\u003E{ params }\u003C\u002Fspan\u003E) \u003C\u002Fspan\u003E{\\n  \u003Cspan class=\\\"hljs-comment\\\"\u003E\u002F\u002F we could get the dynamic slug from the parameter of get.\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E { slug } = params;\\n\\n  \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E { metadata, content } = process(\u003Cspan class=\\\"hljs-string\\\"\u003E`src\u002Fposts\u002F\u003Cspan class=\\\"hljs-subst\\\"\u003E${slug}\u003C\u002Fspan\u003E.md`\u003C\u002Fspan\u003E);\\n  \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E body = \u003Cspan class=\\\"hljs-built_in\\\"\u003EJSON\u003C\u002Fspan\u003E.stringify({ metadata, content });\\n\\n  \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E { body }\\n}\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003ENow we have the function that supply the data, we can use the \u003Ccode\u003Eload\u003C\u002Fcode\u003E function to load them. Take \u003Ccode\u003E[slug].svelte\u003C\u002Fcode\u003E as example, we will add\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"hljs language-html\\\"\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&#x3C;\u003Cspan class=\\\"hljs-name\\\"\u003Escript\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-attr\\\"\u003Econtext\u003C\u002Fspan\u003E=\u003Cspan class=\\\"hljs-string\\\"\u003E\\\"module\\\"\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"javascript\\\"\u003E\\n  \u003Cspan class=\\\"hljs-keyword\\\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-keyword\\\"\u003Easync\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-function\\\"\u003E\u003Cspan class=\\\"hljs-keyword\\\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-title\\\"\u003Eload\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-params\\\"\u003E{ page, fetch }\u003C\u002Fspan\u003E) \u003C\u002Fspan\u003E{\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E slug = page.params.slug;\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Econst\u003C\u002Fspan\u003E post = \u003Cspan class=\\\"hljs-keyword\\\"\u003Eawait\u003C\u002Fspan\u003E fetch(\u003Cspan class=\\\"hljs-string\\\"\u003E`\u003Cspan class=\\\"hljs-subst\\\"\u003E${slug}\u003C\u002Fspan\u003E.json`\u003C\u002Fspan\u003E)\\n        .then(\u003Cspan class=\\\"hljs-function\\\"\u003E(\u003Cspan class=\\\"hljs-params\\\"\u003Er\u003C\u002Fspan\u003E) =\u003E\u003C\u002Fspan\u003E r.json());\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E {\\n      \u003Cspan class=\\\"hljs-attr\\\"\u003Eprops\u003C\u002Fspan\u003E: { post }\\n    };\\n  }\\n\u003C\u002Fspan\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&#x3C;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Escript\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"hljs-tag\\\"\u003E&#x3C;\u003Cspan class=\\\"hljs-name\\\"\u003Escript\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\\\"javascript\\\"\u003E\\n  \u003Cspan class=\\\"hljs-comment\\\"\u003E\u002F\u002F post will have metadata and content\u003C\u002Fspan\u003E\\n  \u003Cspan class=\\\"hljs-keyword\\\"\u003Eexport\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-keyword\\\"\u003Elet\u003C\u002Fspan\u003E post;\\n\u003C\u002Fspan\u003E\u003Cspan class=\\\"hljs-tag\\\"\u003E&#x3C;\u002F\u003Cspan class=\\\"hljs-name\\\"\u003Escript\u003C\u002Fspan\u003E\u003E\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"hljs-comment\\\"\u003E&#x3C;!--show the post html with @html--\u003E\u003C\u002Fspan\u003E\\n{@html post.content}\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003Eto the top of the \u003Ccode\u003E[slug].svelte\u003C\u002Fcode\u003E, so that the page could get data from \u003Ccode\u003E${slug}.json\u003C\u002Fcode\u003E. And remember to add \u003Ccode\u003Econtext=\\\"module\\\"\u003C\u002Fcode\u003E to the script tag around \u003Ccode\u003Eload\u003C\u002Fcode\u003E, as we need the data load before the component is rendered.\u003C\u002Fp\u003E\\n\u003Cp\u003ESimilarly, we could add the \u003Ccode\u003Eload\u003C\u002Fcode\u003E function to \u003Ccode\u003Eindex.svelte\u003C\u002Fcode\u003E and this is the basic data stream in SvelteKit.\u003C\u002Fp\u003E\\n\u003Ch2\u003EParse and Render the markdown files\u003C\u002Fh2\u003E\\n\u003Cp\u003EFor this blog, I chose \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Fremarkjs\u002Fremark\\\"\u003Eremark\u003C\u002Fa\u003E as the markdown processor. It is one of the most popular markdown parser now and is the one that supports the great \u003Ca href=\\\"https:\u002F\u002Fwww.gatsbyjs.com\u002F\\\"\u003EGatsby\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\\n\u003Cp\u003E\u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Fremarkjs\u002Fremark\\\"\u003Eremark\u003C\u002Fa\u003E is actually a part of the \u003Ca href=\\\"https:\u002F\u002Funifiedjs.com\u002F\\\"\u003Eunifiedjs\u003C\u002Fa\u003E ecosystem, a bunch of tools to help extracting the syntax tree or converting between content formats like markdown or html. To convert a markdown file into html, we could simply:\u003C\u002Fp\u003E\\n\u003Cpre\u003E\u003Ccode class=\\\"hljs language-js\\\"\u003E\u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E vfile \u003Cspan class=\\\"hljs-keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E'to-vfile'\u003C\u002Fspan\u003E;\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E unified \u003Cspan class=\\\"hljs-keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E'unified'\u003C\u002Fspan\u003E;\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E remarkParse \u003Cspan class=\\\"hljs-keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E'remark-parse'\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E remark2rehype \u003Cspan class=\\\"hljs-keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E'remark-rehype'\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Eimport\u003C\u002Fspan\u003E stringify \u003Cspan class=\\\"hljs-keyword\\\"\u003Efrom\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-string\\\"\u003E'rehype-stringify'\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"hljs-keyword\\\"\u003Elet\u003C\u002Fspan\u003E processor = unified()\\n    .use(remarkParse)    \u003Cspan class=\\\"hljs-comment\\\"\u003E\u002F\u002F parse into markdown syntax tree\u003C\u002Fspan\u003E\\n    .use(remark2rehype)  \u003Cspan class=\\\"hljs-comment\\\"\u003E\u002F\u002F convert to html syntax tree\u003C\u002Fspan\u003E\\n    .use(stringify)      \u003Cspan class=\\\"hljs-comment\\\"\u003E\u002F\u002F turn html syntax tree to html\u003C\u002Fspan\u003E\\n\\n\u003Cspan class=\\\"hljs-comment\\\"\u003E\u002F\u002F process function will return the generated html string.\u003C\u002Fspan\u003E\\n\u003Cspan class=\\\"hljs-function\\\"\u003E\u003Cspan class=\\\"hljs-keyword\\\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\\\"hljs-title\\\"\u003Eprocess\u003C\u002Fspan\u003E(\u003Cspan class=\\\"hljs-params\\\"\u003Efilename\u003C\u002Fspan\u003E) \u003C\u002Fspan\u003E{\\n    \u003Cspan class=\\\"hljs-comment\\\"\u003E\u002F\u002F use vfile to read the file, could use fs if you like.\u003C\u002Fspan\u003E\\n    \u003Cspan class=\\\"hljs-keyword\\\"\u003Ereturn\u003C\u002Fspan\u003E processor.processSync(vfile.readSync(filename));\\n}\\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\\n\u003Cp\u003ENotice that unifiedjs is organized with multi-repo pattern and all the packages imported in the above snippet are in separate repos.\u003C\u002Fp\u003E\\n\u003Cp\u003ETo get the title of the markdown file for index page, I added a metadata section to the markdown file. I'm not sure if I did this in the correctly, so I'm not going to describe my solution. If you have interest in parsing the metadata of the markdown, please refer to the \u003Ca href=\\\"https:\u002F\u002Fgithub.com\u002Fsvelteland\u002Fsvelte-kit-blog-demo\u002Fblob\u002Fmain\u002Fsrc\u002Flib\u002Fmarkdown.js\\\"\u003E\u003Ccode\u003Emarkdown.js\u003C\u002Fcode\u003E\u003C\u002Fa\u003E file in the repo.\u003C\u002Fp\u003E\\n\u003Ch2\u003EConclusion\u003C\u002Fh2\u003E\\n\u003Cp\u003EHurray! We have built a blog app that runs locally. Next I will show you how to deploy the blog to Github Pages.\u003C\u002Fp\u003E\\n\u003Ch2\u003ETips\u003C\u002Fh2\u003E\\n\u003Cp\u003ESome confusing errors could be solved by moving the dependencies to \u003Ccode\u003EdevDependencies\u003C\u002Fcode\u003E due to some bugs of Vite.\u003C\u002Fp\u003E\"}"}</script>
</div>
	</body>
</html>
